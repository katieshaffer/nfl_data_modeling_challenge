version: 2

models:
  - name: fct_fantasy_point_leaders
    description: "Fact table ranking players by their fantasy performance using both standard and PPR scoring."
    columns:
      - name: player_id
        description: "Unique identifier for the player."
      - name: player_name
        description: "Name of the player."
      - name: season
        description: "Season."
      - name: position
        description: "Player's position (e.g., QB, RB, WR, TE)."
      - name: recent_team
        description: "The player's most recent team."
      - name: total_fantasy_points
        description: "Total fantasy points scored by the player (standard scoring) across the considered period."
        meta:
          metrics:
            total_fp:
              type: sum
              label: "Total Fantasy Points"
      - name: total_fantasy_points_ppr
        description: "Total fantasy points scored by the player under PPR (points per reception) scoring across the considered period."
        meta:
          metrics:
            sum_fantasy_points_ppr:
              type: sum
      - name: games_played
        description: "Number of games (weeks) the player participated in."
        meta:
          metrics:
            total_games_played:
              type: sum
              label: "Total Games Played"
      - name: avg_fantasy_points_per_game
        description: "Average standard fantasy points per game played."
        meta:
          metrics:
            avg_fantasy_points_per_game_:
              type: average
      - name: avg_fantasy_points_ppr_per_game
        description: "Average PPR fantasy points per game played."
        meta:
          metrics:
            avg_fantasy_points_ppr_per_game_:
              type: average
      - name: standard_rank
        description: "The player's rank among all players based on total standard fantasy points."
        meta:
          metrics:
            sum_standard_rank:
              type: count
              label: "Count Standard Rank"
      - name: ppr_rank
        description: "The player's rank among all players based on total PPR fantasy points."
        meta:
          metrics:
            count_ppr_rank:
              type: count
              label: "Count PPR Rank"

  - name: fct_red_zone_player_stats
    description: "Fact table summarizing player performance within the red zone, capturing rushing and passing opportunities."
    columns:
      - name: year
      - name: fantasy_player_id
        description: "Fantasy-specific unique identifier for the player."
      - name: fantasy_player_name
        description: "Name of the player as recognized for fantasy purposes."
      - name: total_opportunities
        description: "Sum of a player's total red zone rush attempts and targets (pass attempts to them)."
        meta:
          metrics:
            total_opportunities_:
              type: sum
              label: "Total Opportunities"
            total_opportunities_avg:
              type: average
              label: "Average Opportunities"
              round: 2
      - name: total_rush_attempts
        description: "Total number of red zone rushing attempts by the player."
        meta:
          metrics:
            total_rush_attempts_:
              type: sum
              label: "Total Rush Attempts"
            avg_rush_attempts:
              type: average
              label: "Average Rush Attempts"
              round: 2
      - name: total_targets
        description: "Total number of red zone targets (pass attempts) directed to the player."
        meta:
          metrics:
            total_targets_:
              type: sum
              label: "Total Targets"
            avg_targets:
              type: average
              label: "Average Targets"
              round: 2
      - name: total_pass_completions
        description: "Total number of red zone passes completed to the player."
        meta:
          metrics:
            total_pass_complete:
              type: sum
              label: "Total Pass Completions"
            avg_pass_complete:
              type: average
              label: "Average Pass Complete"
              round: 2

  - name: fct_fantasy_points_allowed_by_defense
    description: Fact table summarizing how each defense performed against different offensive positions in terms of fantasy points and yardage allowed, along with the variety of players they faced.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - year
            - defteam
            - season_type
    columns:
      - name: year
        description: "The year of the season"
      - name: season_type
        description: "Type of season (e.g., regular, postseason)"
      - name: defteam
        description: "The defending team"
      - name: total_rushing_yards
        description: "Total rushing yards allowed"
        meta:
          metrics:
            avg_rushing_yards_allowed:
              type: average
      - name: games_played
        description: "Number of games played"
        meta:
          metrics:
            games_played_:
              type: sum
              label: "Number of games played"
      - name: qbs_faced
        description: "Number of quarterbacks faced"
        meta:
          metrics:
            avg_qbs_faced:
              type: average
      - name: rbs_faced
        description: "Number of running backs faced"
        meta:
          metrics:
            avg_rbs_faced:
              type: average
      - name: wrs_faced
        description: "Number of wide receivers faced"
        meta:
          metrics:
            avg_wrs_faced:
              type: average
      - name: total_qb_points
        meta:
          metrics:
            sum_qb_points:
              type: sum
      - name: total_rb_points
        meta:
          metrics:
            sum_rb_points:
              type: sum

  - name: fct_player_injury_history
    description: Fact table containing the historical injury records for players.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - team_id
            - injury_status
            - injury_details
            - position
            - body_area
    columns:
      - name: severe_injuries
        description: "Count of severe injuries for the player and given year."
        meta:
          metrics:
            total_severe_injuries:
              type: sum
              label: "Total severe injuries"
      - name: moderate_injuries
        description: "Count of moderate injuries for the player and given year."
        meta:
          metrics:
            total_moderate_injuries:
              type: sum
              label: "Total moderate injuries"
      - name: minor_injuries
        description: "Count of minor injuries for the player and given year."
        meta:
          metrics:
            total_minor_injuries:
              type: sum
              label: "Total minor injuries"
      - name: position
        description: "Unique identifier for the position."
      - name: body_area
        description: "Body area."
      - name: team_id
        description: "Identifier for the player's team."
      - name: injury_status
      - name: team_name
        description: "Name for the player's team."
      - name: injury_details
      - name: injuries
        description: "Total number of injuries a player had in the given year."
        meta:
          metrics:
            total_injuries_in_year:
              type: sum
              label: "Total injuries"
      - name: injury_impact_index
        meta:
          metrics:
            impact_index:
              type: sum
              label: "Injury impact Index"
